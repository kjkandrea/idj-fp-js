<!--  cd ./codeNote/02_dojo/usefulClosureHTML && lite-server index.html -->
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.13.1/underscore-min.js"></script>
    <title>Document</title>
</head>
<body>
<div class="user-list"></div>
<h1>subscribed</h1>
<script>
    const users = [
        { id: 1, name: 'HA', age: 25 },
        { id: 2, name: 'PJ', age: 28 },
        { id: 3, name: 'JE', age: 27 },
    ]

    $('.user-list').append(
        _.map(users, function (user) { // (1) 이 함수는 클로저가 아니다.
            const button = $('<button>').text(user.name) // (2)
            button.click(function () { // (3) 계속 유지되는 클로저 (내부에서 user를 사용했다.)
                if (confirm(user.name + '님을 팔로잉 하시겠습니까?')) {
                    follow(user)
                } // (4)
            })
            return button // (5)
        }))

    function postFollow ({ user_id }) {
        console.log(user_id + ' dummy post...')
        return new Promise(res => {
                setTimeout(() => res(), 200)
            },
        )
    }

    function follow (user) {
        postFollow({ user_id: user.id }).then(() => alert(`이제 ${user.name}님의 소식을 보실 수 있습니다.`)) // (6) 클로저가 되었다가 없어지는 클로저
    }
</script>
</body>
</html>